<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="https://sadness96.github.io/images/Logo300.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://sadness96.github.io/images/Logo30.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://sadness96.github.io/images/Logo16.png">
  <link rel="mask-icon" href="https://sadness96.github.io/images/logo.svg" color="#222">
<link rel="stylesheet" href="/blog/css/main.css">
<link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css">
  <link rel="stylesheet" href="/blog/lib/pace/pace-theme-minimal.min.css">
  <script src="/blog/lib/pace/pace.min.js"></script>
<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"sadness96.github.io","root":"/blog/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>
  <meta property="og:type" content="article">
<meta property="og:title" content="监控相机控制">
<meta property="og:url" content="http://sadness96.github.io/blog/2023/12/09/csharp-CameraControl/index.html">
<meta property="og:site_name" content="个人博客 - 刘佳华">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://sadness96.github.io/images/blog/csharp-CameraControl/CameraControlTest.jpg">
<meta property="article:published_time" content="2023-12-09T04:45:00.000Z">
<meta property="article:modified_time" content="2023-12-09T05:19:25.827Z">
<meta property="article:author" content="LiuJiaHua">
<meta property="article:tag" content="c#">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://sadness96.github.io/images/blog/csharp-CameraControl/CameraControlTest.jpg">
<link rel="canonical" href="http://sadness96.github.io/blog/2023/12/09/csharp-CameraControl/">
<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>
  <title>监控相机控制 | 个人博客 - 刘佳华</title>
  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }
  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>
</head>
<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
  <div class="site-meta">
    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">个人博客 - 刘佳华</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>
<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">
    <a href="/blog/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>
  </li>
        <li class="menu-item menu-item-archives">
    <a href="/blog/archives" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>
  </li>
        <li class="menu-item menu-item-categories">
    <a href="/blog/categories" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>
  </li>
        <li class="menu-item menu-item-tags">
    <a href="/blog/tags" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>
  </li>
        <li class="menu-item menu-item-about">
    <a href="/blog/about" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>
  </li>
        <li class="menu-item menu-item-github">
    <a href="https://github.com/Sadness96" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>
  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>
    </div>
  </div>
</div>
    </header>
    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div class="content post posts-expand">
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://sadness96.github.io/blog/2023/12/09/csharp-CameraControl/">
    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://avatars3.githubusercontent.com/u/19670054?s=460&v=4">
      <meta itemprop="name" content="LiuJiaHua">
      <meta itemprop="description" content="记录生活,记录学习,记录成长!">
    </span>
    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客 - 刘佳华">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          监控相机控制
        </h1>
        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="创建时间：2023-12-09 12:45:00" itemprop="dateCreated datePublished" datetime="2023-12-09T12:45:00+08:00">2023-12-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/blog/categories/C-Net/" itemprop="url" rel="index"><span itemprop="name">C#.Net</span></a>
                </span>
            </span>
        </div>
      </header>
    <div class="post-body" itemprop="articleBody">
        <p><img src="https://sadness96.github.io/images/blog/csharp-CameraControl/CameraControlTest.jpg"/></p>
<span id="more"></span>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>与主流监控相机厂商（<a target="_blank" rel="noopener" href="https://www.hikvision.com/cn/">海康</a>、<a target="_blank" rel="noopener" href="https://www.dahuatech.com/">大华</a>、<a target="_blank" rel="noopener" href="https://cn.uniview.com/">宇视</a>） SDK 和开放行业接口 <a target="_blank" rel="noopener" href="https://www.onvif.org/">Onvif</a> 对接，实现画面预览、PTZ 云台控制等操作，二次封装后提供引用库、WebAPI 接口、Socket 等多种方式调用控制。</p>
<h3 id="核心代码"><a href="#核心代码" class="headerlink" title="核心代码"></a>核心代码</h3><p>注意核心代码并不完整，仅做参考</p>
<h4 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 相机控制接口</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">ICameraControl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 登录</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channels&quot;&gt;</span>通道号集合<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否登录成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">Login</span>(<span class="params"><span class="keyword">out</span> List&lt;CameraChannel&gt; channels</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 退出登录</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否退出成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">Logout</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取流 RTSP 地址</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;streamUris&quot;&gt;</span>流地址集合<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否获取成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">GetStreamUri</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> List&lt;<span class="built_in">string</span>&gt; streamUris</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 实时预览</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;hPlayWnd&quot;&gt;</span>渲染句柄<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">RealPlay</span>(<span class="params"><span class="built_in">int</span> channel, IntPtr hPlayWnd</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 停止实时预览</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">StopRealPlay</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 云台控制</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 方向、变焦、变倍、光圈</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 灯光、雨刷、风扇、加热、除雪</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzCommand&quot;&gt;</span>控制命令<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;isStart&quot;&gt;</span>是否启动<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;speed&quot;&gt;</span>速度<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">PtzControl</span>(<span class="params"><span class="built_in">int</span> channel, PTZCommand ptzCommand, <span class="built_in">bool</span> isStart, <span class="built_in">int</span> speed = <span class="number">1</span></span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取云台 PTZ 值</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzValue&quot;&gt;</span>PTZ 参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">GetPTZValue</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> PTZValue ptzValue</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 设置云台 PTZ 值</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzValue&quot;&gt;</span>PTZ 参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否设置成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">SetPTZValue</span>(<span class="params"><span class="built_in">int</span> channel, PTZValue ptzValue</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取云台预置位列表</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzPresets&quot;&gt;</span>预置位列表<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">GetPTZPreset</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> List&lt;PTZPreset&gt; ptzPresets</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 云台预置位控制</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzCommand&quot;&gt;</span>控制命令<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;presetIndex&quot;&gt;</span>预置位序号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;presetName&quot;&gt;</span>预置位名称，设置预置位时使用<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="built_in">bool</span> <span class="title">PTZPresetControl</span>(<span class="params"><span class="built_in">int</span> channel, PTZCommand ptzCommand, <span class="built_in">int</span> presetIndex, <span class="built_in">string</span> presetName</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="海康"><a href="#海康" class="headerlink" title="海康"></a>海康</h4><p>使用 <a target="_blank" rel="noopener" href="https://open.hikvision.com/download/5cda567cf47ae80dd41a54b3?type=10">官方 SDK</a> 对接。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 海康相机控制</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HikvisionControl</span> : <span class="title">ICameraControl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 用户 ID 值</span></span><br><span class="line">    <span class="keyword">private</span> Int32 m_lUserID = <span class="number">-1</span>;</span><br><span class="line">    <span class="comment">// 预览句柄</span></span><br><span class="line">    <span class="keyword">private</span> Int32 m_lRealHandle = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CHCNetSDK.NET_DVR_USER_LOGIN_INFO struLogInfo;</span><br><span class="line">    <span class="keyword">public</span> CHCNetSDK.NET_DVR_DEVICEINFO_V40 DeviceInfo;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> CHCNetSDK.NET_DVR_PRESET_NAME[] m_struPreSetCfg = <span class="keyword">new</span> CHCNetSDK.NET_DVR_PRESET_NAME[<span class="number">300</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 海康相机控制构造函数</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ip&quot;&gt;</span>IP<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;userName&quot;&gt;</span>用户名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;password&quot;&gt;</span>密码<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;port&quot;&gt;</span>端口<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HikvisionControl</span>(<span class="params"><span class="built_in">string</span> ip, <span class="built_in">string</span> userName, <span class="built_in">string</span> password, <span class="built_in">string</span> port = <span class="string">&quot;8000&quot;</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        struLogInfo = <span class="keyword">new</span> CHCNetSDK.NET_DVR_USER_LOGIN_INFO();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设备IP地址或者域名</span></span><br><span class="line">        <span class="built_in">byte</span>[] byIP = Encoding.Default.GetBytes(ip);</span><br><span class="line">        struLogInfo.sDeviceAddress = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">129</span>];</span><br><span class="line">        byIP.CopyTo(struLogInfo.sDeviceAddress, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设备用户名</span></span><br><span class="line">        <span class="built_in">byte</span>[] byUserName = Encoding.Default.GetBytes(userName);</span><br><span class="line">        struLogInfo.sUserName = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">64</span>];</span><br><span class="line">        byUserName.CopyTo(struLogInfo.sUserName, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设备密码</span></span><br><span class="line">        <span class="built_in">byte</span>[] byPassword = Encoding.Default.GetBytes(password);</span><br><span class="line">        struLogInfo.sPassword = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">64</span>];</span><br><span class="line">        byPassword.CopyTo(struLogInfo.sPassword, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设备服务端口号</span></span><br><span class="line">        struLogInfo.wPort = <span class="built_in">ushort</span>.Parse(port);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 是否异步登录：0- 否，1- 是</span></span><br><span class="line">        struLogInfo.bUseAsynLogin = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化</span></span><br><span class="line">        CHCNetSDK.NET_DVR_Init();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存SDK日志 To save the SDK log</span></span><br><span class="line">        <span class="comment">//CHCNetSDK.NET_DVR_SetLogToFile(3, &quot;C:\\SdkLog\\&quot;, true);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 登录</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channels&quot;&gt;</span>通道号集合<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否登录成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Login</span>(<span class="params"><span class="keyword">out</span> List&lt;CameraChannel&gt; channels</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        channels = <span class="keyword">new</span> List&lt;CameraChannel&gt;();</span><br><span class="line"></span><br><span class="line">        DeviceInfo = <span class="keyword">new</span> CHCNetSDK.NET_DVR_DEVICEINFO_V40();</span><br><span class="line">        <span class="comment">// 登录设备 Login the device</span></span><br><span class="line">        m_lUserID = CHCNetSDK.NET_DVR_Login_V40(<span class="keyword">ref</span> struLogInfo, <span class="keyword">ref</span> DeviceInfo);</span><br><span class="line">        <span class="keyword">if</span> (m_lUserID &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> iLastErr = CHCNetSDK.NET_DVR_GetLastError();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 模拟通道号</span></span><br><span class="line">            <span class="keyword">var</span> vChanNum = DeviceInfo.struDeviceV30.byChanNum;</span><br><span class="line">            <span class="comment">// 模拟通道起始通道号</span></span><br><span class="line">            <span class="keyword">var</span> vStartChan = DeviceInfo.struDeviceV30.byStartChan;</span><br><span class="line">            <span class="comment">// 添加模拟通道号</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; vChanNum; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                channels.Add(<span class="keyword">new</span> CameraChannel()</span><br><span class="line">                &#123;</span><br><span class="line">                    ChannelID = vStartChan + i,</span><br><span class="line">                    ChannelName = <span class="string">$&quot;Channel <span class="subst">&#123;vStartChan + i&#125;</span>&quot;</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 退出登录</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否退出成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Logout</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// 注销用户与释放 SDK 资源</span></span><br><span class="line">        <span class="keyword">return</span> CHCNetSDK.NET_DVR_Logout(m_lUserID) &amp;&amp; CHCNetSDK.NET_DVR_Cleanup();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取流 RTSP 地址</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;streamUris&quot;&gt;</span>流地址集合<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否获取成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">GetStreamUri</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> List&lt;<span class="built_in">string</span>&gt; streamUris</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        streamUris = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 实时预览</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;hPlayWnd&quot;&gt;</span>渲染句柄<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">RealPlay</span>(<span class="params"><span class="built_in">int</span> channel, IntPtr hPlayWnd</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_lRealHandle &gt;= <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 已经开启预览</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CHCNetSDK.NET_DVR_PREVIEWINFO lpPreviewInfo = <span class="keyword">new</span> CHCNetSDK.NET_DVR_PREVIEWINFO();</span><br><span class="line">        lpPreviewInfo.hPlayWnd = hPlayWnd;<span class="comment">//预览窗口</span></span><br><span class="line">        lpPreviewInfo.lChannel = channel;<span class="comment">//预览的设备通道</span></span><br><span class="line">        lpPreviewInfo.dwStreamType = <span class="number">0</span>;<span class="comment">//码流类型：0-主码流，1-子码流，2-码流3，3-码流4，以此类推</span></span><br><span class="line">        lpPreviewInfo.dwLinkMode = <span class="number">0</span>;<span class="comment">//连接方式：0- TCP方式，1- UDP方式，2- 多播方式，3- RTP方式，4-RTP/RTSP，5-RSTP/HTTP </span></span><br><span class="line">        lpPreviewInfo.bBlocked = <span class="literal">true</span>; <span class="comment">//0- 非阻塞取流，1- 阻塞取流</span></span><br><span class="line">        lpPreviewInfo.dwDisplayBufNum = <span class="number">1</span>; <span class="comment">//播放库播放缓冲区最大缓冲帧数</span></span><br><span class="line">        lpPreviewInfo.byProtoType = <span class="number">0</span>;</span><br><span class="line">        lpPreviewInfo.byPreviewMode = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        IntPtr pUser = <span class="keyword">new</span> IntPtr();<span class="comment">//用户数据</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 打开预览 Start live view </span></span><br><span class="line">        m_lRealHandle = CHCNetSDK.NET_DVR_RealPlay_V40(m_lUserID, <span class="keyword">ref</span> lpPreviewInfo, <span class="literal">null</span><span class="comment">/*RealData*/</span>, pUser);</span><br><span class="line">        <span class="keyword">if</span> (m_lRealHandle &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> iLastErr = <span class="string">$&quot;NET_DVR_RealPlay_V40 failed, error code= <span class="subst">&#123;CHCNetSDK.NET_DVR_GetLastError()&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 停止实时预览</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">StopRealPlay</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (m_lRealHandle &lt; <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 未开启预览</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!CHCNetSDK.NET_DVR_StopRealPlay(m_lRealHandle))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> iLastErr = <span class="string">$&quot;NET_DVR_StopRealPlay failed, error code= <span class="subst">&#123;CHCNetSDK.NET_DVR_GetLastError()&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        m_lRealHandle = <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 云台控制</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 方向、变焦、变倍、光圈</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 灯光、雨刷、风扇、加热、除雪</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzCommand&quot;&gt;</span>控制命令<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;isStart&quot;&gt;</span>是否启动<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;speed&quot;&gt;</span>速度<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">PtzControl</span>(<span class="params"><span class="built_in">int</span> channel, PTZCommand ptzCommand, <span class="built_in">bool</span> isStart, <span class="built_in">int</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">uint</span> dwPTZCommand = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (ptzCommand)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Light: dwPTZCommand = CHCNetSDK.LIGHT_PWRON; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Wiper: dwPTZCommand = CHCNetSDK.WIPER_PWRON; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Fan: dwPTZCommand = CHCNetSDK.FAN_PWRON; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Heater: dwPTZCommand = CHCNetSDK.HEATER_PWRON; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.SnowRemoval: dwPTZCommand = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Aux1: dwPTZCommand = CHCNetSDK.AUX_PWRON1; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Aux2: dwPTZCommand = CHCNetSDK.AUX_PWRON2; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.SetPreset: dwPTZCommand = CHCNetSDK.SET_PRESET; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.ClePreset: dwPTZCommand = CHCNetSDK.CLE_PRESET; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.GotoPreset: dwPTZCommand = CHCNetSDK.GOTO_PRESET; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> PTZCommand.ZoomIn: dwPTZCommand = CHCNetSDK.ZOOM_IN; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.ZoomOut: dwPTZCommand = CHCNetSDK.ZOOM_OUT; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.FocusNear: dwPTZCommand = CHCNetSDK.FOCUS_NEAR; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.FocusFar: dwPTZCommand = CHCNetSDK.FOCUS_FAR; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.IrisOpen: dwPTZCommand = CHCNetSDK.IRIS_OPEN; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.IrisClose: dwPTZCommand = CHCNetSDK.IRIS_CLOSE; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> PTZCommand.TiltUp: dwPTZCommand = CHCNetSDK.TILT_UP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.TiltDown: dwPTZCommand = CHCNetSDK.TILT_DOWN; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.PanLeft: dwPTZCommand = CHCNetSDK.PAN_LEFT; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.PanRight: dwPTZCommand = CHCNetSDK.PAN_RIGHT; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.UpLeft: dwPTZCommand = CHCNetSDK.UP_LEFT; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.UpRight: dwPTZCommand = CHCNetSDK.UP_RIGHT; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.DownLeft: dwPTZCommand = CHCNetSDK.DOWN_LEFT; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.DownRight: dwPTZCommand = CHCNetSDK.DOWN_RIGHT; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.PanAuto: dwPTZCommand = CHCNetSDK.PAN_AUTO; <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> CHCNetSDK.NET_DVR_PTZControlWithSpeed_Other(m_lUserID, channel, dwPTZCommand, isStart ? (<span class="built_in">uint</span>)<span class="number">0</span> : <span class="number">1</span>, (<span class="built_in">uint</span>)speed);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取云台 PTZ 值</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzValue&quot;&gt;</span>PTZ 参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">GetPTZValue</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> PTZValue ptzValue</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        CHCNetSDK.NET_DVR_PTZPOS m_struPtzCfg = <span class="keyword">new</span> CHCNetSDK.NET_DVR_PTZPOS();</span><br><span class="line"></span><br><span class="line">        <span class="built_in">uint</span> dwReturn = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">int</span> nSize = Marshal.SizeOf(m_struPtzCfg);</span><br><span class="line">        IntPtr ptrPtzCfg = Marshal.AllocHGlobal(nSize);</span><br><span class="line">        Marshal.StructureToPtr(m_struPtzCfg, ptrPtzCfg, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!CHCNetSDK.NET_DVR_GetDVRConfig(m_lUserID, CHCNetSDK.NET_DVR_GET_PTZPOS, channel, ptrPtzCfg, (<span class="built_in">uint</span>)nSize, <span class="keyword">ref</span> dwReturn))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 获取参数失败</span></span><br><span class="line">            <span class="keyword">var</span> iLastErr = <span class="string">&quot;NET_DVR_GetDVRConfig failed, error code:&quot;</span> + CHCNetSDK.NET_DVR_GetLastError();</span><br><span class="line">            ptzValue = <span class="keyword">new</span> PTZValue();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            m_struPtzCfg = (CHCNetSDK.NET_DVR_PTZPOS)Marshal.PtrToStructure(ptrPtzCfg, <span class="keyword">typeof</span>(CHCNetSDK.NET_DVR_PTZPOS));</span><br><span class="line">            <span class="comment">// 成功获取显示 ptz 参数</span></span><br><span class="line">            ptzValue = <span class="keyword">new</span> PTZValue()</span><br><span class="line">            &#123;</span><br><span class="line">                P = (<span class="built_in">float</span>)(Convert.ToUInt16(Convert.ToString(m_struPtzCfg.wPanPos, <span class="number">16</span>)) * <span class="number">0.1</span>m),</span><br><span class="line">                T = (<span class="built_in">float</span>)(Convert.ToUInt16(Convert.ToString(m_struPtzCfg.wTiltPos, <span class="number">16</span>)) * <span class="number">0.1</span>m),</span><br><span class="line">                Z = (<span class="built_in">float</span>)(Convert.ToUInt16(Convert.ToString(m_struPtzCfg.wZoomPos, <span class="number">16</span>)) * <span class="number">0.1</span>m)</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 设置云台 PTZ 值</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzValue&quot;&gt;</span>PTZ 参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否设置成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">SetPTZValue</span>(<span class="params"><span class="built_in">int</span> channel, PTZValue ptzValue</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// 海康设置云台时 PTZ 参数值小数超过 1 位为会报错</span></span><br><span class="line">        ptzValue.P = (<span class="built_in">float</span>)Math.Round(ptzValue.P, <span class="number">1</span>);</span><br><span class="line">        ptzValue.T = (<span class="built_in">float</span>)Math.Round(ptzValue.T, <span class="number">1</span>);</span><br><span class="line">        ptzValue.Z = (<span class="built_in">float</span>)Math.Round(ptzValue.Z, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        CHCNetSDK.NET_DVR_PTZPOS m_struPtzCfg = <span class="keyword">new</span> CHCNetSDK.NET_DVR_PTZPOS();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 操作类型，仅在设置时有效。1-定位PTZ参数，2-定位P参数，3-定位T参数，4-定位Z参数，5-定位PT参数 </span></span><br><span class="line">        m_struPtzCfg.wAction = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// 实际显示的PTZ值是获取到的十六进制值的十分之一，如获取的水平参数P的值是0x1750，实际显示的P值为175度；获取到的垂直参数T的值是0x0789，实际显示的T值为78.9度；获取到的变倍参数Z的值是0x1100，实际显示的Z值为110倍。</span></span><br><span class="line">        m_struPtzCfg.wPanPos = Convert.ToUInt16(Convert.ToString(ptzValue.P * <span class="number">10</span>), <span class="number">16</span>);</span><br><span class="line">        m_struPtzCfg.wTiltPos = Convert.ToUInt16(Convert.ToString(ptzValue.T * <span class="number">10</span>), <span class="number">16</span>);</span><br><span class="line">        m_struPtzCfg.wZoomPos = Convert.ToUInt16(Convert.ToString(ptzValue.Z * <span class="number">10</span>), <span class="number">16</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">int</span> nSize = Marshal.SizeOf(m_struPtzCfg);</span><br><span class="line">        IntPtr ptrPtzCfg = Marshal.AllocHGlobal(nSize);</span><br><span class="line">        Marshal.StructureToPtr(m_struPtzCfg, ptrPtzCfg, <span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!CHCNetSDK.NET_DVR_SetDVRConfig(m_lUserID, CHCNetSDK.NET_DVR_SET_PTZPOS, channel, ptrPtzCfg, (<span class="built_in">uint</span>)nSize))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> iLastErr = <span class="string">&quot;NET_DVR_SetDVRConfig failed, error code:&quot;</span> + CHCNetSDK.NET_DVR_GetLastError();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取云台预置位列表</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzPresets&quot;&gt;</span>预置位列表<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">GetPTZPreset</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> List&lt;PTZPreset&gt; ptzPresets</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">uint</span> dwReturn = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">int</span> nSize = Marshal.SizeOf(m_struPreSetCfg[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">int</span> nOutBufSize = nSize * <span class="number">300</span>;</span><br><span class="line">        IntPtr ptrPreSetCfg = Marshal.AllocHGlobal(nOutBufSize);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">300</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Marshal.StructureToPtr(m_struPreSetCfg[i], ptrPreSetCfg + (i * nSize), <span class="literal">false</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!CHCNetSDK.NET_DVR_GetDVRConfig(m_lUserID, CHCNetSDK.NET_DVR_GET_PRESET_NAME, channel, ptrPreSetCfg, (<span class="built_in">uint</span>)nOutBufSize, <span class="keyword">ref</span> dwReturn))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 获取参数失败</span></span><br><span class="line">            <span class="keyword">var</span> iLastErr = <span class="string">&quot;NET_DVR_GetDVRConfig failed, error code:&quot;</span> + CHCNetSDK.NET_DVR_GetLastError();</span><br><span class="line">            ptzPresets = <span class="keyword">new</span> List&lt;PTZPreset&gt;();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            ptzPresets = <span class="keyword">new</span> List&lt;PTZPreset&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="number">300</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                m_struPreSetCfg[i] = (CHCNetSDK.NET_DVR_PRESET_NAME)Marshal.PtrToStructure(ptrPreSetCfg + (i * nSize), <span class="keyword">typeof</span>(CHCNetSDK.NET_DVR_PRESET_NAME));</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 添加数据</span></span><br><span class="line">                ptzPresets.Add(<span class="keyword">new</span> PTZPreset()</span><br><span class="line">                &#123;</span><br><span class="line">                    ID = m_struPreSetCfg[i].wPresetNum,</span><br><span class="line">                    Name = HikvisionEncoding.GetGBKString(m_struPreSetCfg[i].byName)</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 云台预置位控制</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzCommand&quot;&gt;</span>控制命令<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;presetIndex&quot;&gt;</span>预置位序号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;presetName&quot;&gt;</span>预置位名称，设置预置位时使用<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">PTZPresetControl</span>(<span class="params"><span class="built_in">int</span> channel, PTZCommand ptzCommand, <span class="built_in">int</span> presetIndex, <span class="built_in">string</span> presetName</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">uint</span> dwPTZCommand = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (ptzCommand)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.SetPreset:</span><br><span class="line">                dwPTZCommand = CHCNetSDK.SET_PRESET;</span><br><span class="line">                <span class="comment">// 设置预置位前先修改预置位名称</span></span><br><span class="line">                CHCNetSDK.NET_DVR_PRESET_NAME struPreSetCfg = m_struPreSetCfg[presetIndex - <span class="number">1</span>];</span><br><span class="line">                struPreSetCfg.byRes = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">58</span>];</span><br><span class="line">                struPreSetCfg.byRes1 = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">2</span>];</span><br><span class="line">                <span class="built_in">int</span> nSize = Marshal.SizeOf(struPreSetCfg);</span><br><span class="line">                IntPtr ptrPreSetCfg = Marshal.AllocHGlobal(nSize);</span><br><span class="line">                struPreSetCfg.dwSize = (<span class="built_in">uint</span>)nSize;</span><br><span class="line">                <span class="built_in">byte</span>[] byPresetName;</span><br><span class="line">                HikvisionEncoding.GetGBKBuffer(presetName, <span class="number">32</span>, <span class="keyword">out</span> byPresetName);</span><br><span class="line">                struPreSetCfg.byName = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">32</span>];</span><br><span class="line">                byPresetName.CopyTo(struPreSetCfg.byName, <span class="number">0</span>);</span><br><span class="line">                Marshal.StructureToPtr(struPreSetCfg, ptrPreSetCfg, <span class="literal">false</span>);</span><br><span class="line">                CHCNetSDK.NET_DVR_SetDVRConfig(m_lUserID, CHCNetSDK.NET_DVR_SET_PRESET_NAME, channel, ptrPreSetCfg, (<span class="built_in">uint</span>)nSize);</span><br><span class="line">                Marshal.FreeHGlobal(ptrPreSetCfg);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.ClePreset: dwPTZCommand = CHCNetSDK.CLE_PRESET; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.GotoPreset: dwPTZCommand = CHCNetSDK.GOTO_PRESET; <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> CHCNetSDK.NET_DVR_PTZPreset_Other(m_lUserID, channel, dwPTZCommand, (<span class="built_in">uint</span>)presetIndex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="宇视"><a href="#宇视" class="headerlink" title="宇视"></a>宇视</h4><p>使用 <a target="_blank" rel="noopener" href="https://cn.uniview.com/Service/Service_Training/Download/SDK/2/201603/796481_194214_0.htm">官方 SDK</a> 对接。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 宇视相机控制</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UniviewControl</span> : <span class="title">ICameraControl</span></span><br><span class="line">&#123;</span><br><span class="line">    IntPtr lpDevHandle = IntPtr.Zero;</span><br><span class="line"></span><br><span class="line">    NETDEV_DEVICE_LOGIN_INFO_S pstDevLoginInfo;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 预览句柄</span></span><br><span class="line">    IntPtr lpRealHandle;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 缩放最大倍数，用于计算球机 Z 值</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> max_zoom = <span class="number">40</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 宇视相机控制构造函数</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ip&quot;&gt;</span>IP<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;userName&quot;&gt;</span>用户名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;password&quot;&gt;</span>密码<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;port&quot;&gt;</span>端口<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UniviewControl</span>(<span class="params"><span class="built_in">string</span> ip, <span class="built_in">string</span> userName, <span class="built_in">string</span> password, <span class="built_in">int</span> port = <span class="number">80</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        pstDevLoginInfo = <span class="keyword">new</span> NETDEV_DEVICE_LOGIN_INFO_S();</span><br><span class="line">        pstDevLoginInfo.szIPAddr = ip;</span><br><span class="line">        pstDevLoginInfo.dwPort = port;</span><br><span class="line">        pstDevLoginInfo.szUserName = userName;</span><br><span class="line">        pstDevLoginInfo.szPassword = password;</span><br><span class="line">        pstDevLoginInfo.dwLoginProto = (<span class="built_in">int</span>)NETDEV_LOGIN_PROTO_E.NETDEV_LOGIN_PROTO_ONVIF;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 初始化</span></span><br><span class="line">        NETDEVSDK.NETDEV_Init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 登录</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channels&quot;&gt;</span>通道号集合<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否登录成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Login</span>(<span class="params"><span class="keyword">out</span> List&lt;CameraChannel&gt; channels</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        channels = <span class="keyword">new</span> List&lt;CameraChannel&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 登录设备</span></span><br><span class="line">        NETDEV_SELOG_INFO_S pstSELogInfo = <span class="keyword">new</span> NETDEV_SELOG_INFO_S();</span><br><span class="line">        lpDevHandle = NETDEVSDK.NETDEV_Login_V30(<span class="keyword">ref</span> pstDevLoginInfo, <span class="keyword">ref</span> pstSELogInfo);</span><br><span class="line">        <span class="keyword">if</span> (lpDevHandle == IntPtr.Zero)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> iLastErr = NETDEVSDK.NETDEV_GetLastError();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 获取设备通道号</span></span><br><span class="line">            <span class="comment">// 测试宇视调用预置位，需要在登录后执行以下获取通道详细列表后才可以使用</span></span><br><span class="line">            <span class="built_in">int</span> pdwChlCount = <span class="number">256</span>;</span><br><span class="line">            IntPtr pstVideoChlList = <span class="keyword">new</span> IntPtr();</span><br><span class="line">            pstVideoChlList = Marshal.AllocHGlobal(<span class="number">256</span> * Marshal.SizeOf(<span class="keyword">typeof</span>(NETDEV_VIDEO_CHL_DETAIL_INFO_S)));</span><br><span class="line">            <span class="built_in">int</span> iRet = NETDEVSDK.NETDEV_QueryVideoChlDetailList(lpDevHandle, <span class="keyword">ref</span> pdwChlCount, pstVideoChlList);</span><br><span class="line">            <span class="keyword">if</span> (NETDEVSDK.TRUE == iRet)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">var</span> m_channelNumber = pdwChlCount;</span><br><span class="line">                NETDEV_VIDEO_CHL_DETAIL_INFO_S stCHLItem = <span class="keyword">new</span> NETDEV_VIDEO_CHL_DETAIL_INFO_S();</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; pdwChlCount; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    IntPtr ptrTemp = <span class="keyword">new</span> IntPtr(pstVideoChlList.ToInt64() + Marshal.SizeOf(<span class="keyword">typeof</span>(NETDEV_VIDEO_CHL_DETAIL_INFO_S)) * i);</span><br><span class="line">                    stCHLItem = (NETDEV_VIDEO_CHL_DETAIL_INFO_S)Marshal.PtrToStructure(ptrTemp, <span class="keyword">typeof</span>(NETDEV_VIDEO_CHL_DETAIL_INFO_S));</span><br><span class="line"></span><br><span class="line">                    channels.Add(<span class="keyword">new</span> CameraChannel()</span><br><span class="line">                    &#123;</span><br><span class="line">                        ChannelID = stCHLItem.dwChannelID,</span><br><span class="line">                        ChannelName = !<span class="built_in">string</span>.IsNullOrEmpty(stCHLItem.szChnName) ? stCHLItem.szChnName : <span class="string">$&quot;Channel <span class="subst">&#123;stCHLItem.dwChannelID&#125;</span>&quot;</span></span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            Marshal.FreeHGlobal(pstVideoChlList);</span><br><span class="line">            <span class="comment">// 获取缩放最大倍数</span></span><br><span class="line">            Task.Run(<span class="keyword">async</span> () =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                max_zoom = <span class="keyword">await</span> GetMaxZoom(pstDevLoginInfo.szIPAddr, pstDevLoginInfo.szUserName, pstDevLoginInfo.szPassword);</span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 退出登录</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否退出成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Logout</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// 注销用户与释放 SDK 资源</span></span><br><span class="line">        <span class="keyword">return</span> NETDEVSDK.NETDEV_Logout(lpDevHandle) &gt;= <span class="number">1</span> &amp;&amp; NETDEVSDK.NETDEV_Cleanup() &gt;= <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取流 RTSP 地址</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;streamUris&quot;&gt;</span>流地址集合<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否获取成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">GetStreamUri</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> List&lt;<span class="built_in">string</span>&gt; streamUris</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        streamUris = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 实时预览</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;hPlayWnd&quot;&gt;</span>渲染句柄<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">RealPlay</span>(<span class="params"><span class="built_in">int</span> channel, IntPtr hPlayWnd</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (lpRealHandle != IntPtr.Zero)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 已经开启预览</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        NETDEV_PREVIEWINFO_S stPreviewInfo = <span class="keyword">new</span> NETDEV_PREVIEWINFO_S();</span><br><span class="line">        stPreviewInfo.dwChannelID = channel;</span><br><span class="line">        stPreviewInfo.dwLinkMode = (<span class="built_in">int</span>)NETDEV_PROTOCAL_E.NETDEV_TRANSPROTOCAL_RTPTCP;</span><br><span class="line">        stPreviewInfo.dwStreamType = (<span class="built_in">int</span>)NETDEV_LIVE_STREAM_INDEX_E.NETDEV_LIVE_STREAM_INDEX_MAIN;</span><br><span class="line">        stPreviewInfo.hPlayWnd = hPlayWnd;</span><br><span class="line">        lpRealHandle = NETDEVSDK.NETDEV_RealPlay(lpDevHandle, <span class="keyword">ref</span> stPreviewInfo, IntPtr.Zero, IntPtr.Zero);</span><br><span class="line">        <span class="keyword">return</span> lpRealHandle != IntPtr.Zero;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 停止实时预览</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">StopRealPlay</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (lpRealHandle == IntPtr.Zero)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 未开启预览</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (NETDEVSDK.FALSE == NETDEVSDK.NETDEV_StopRealPlay(lpRealHandle))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> iLastErr = <span class="string">$&quot;stop real play: <span class="subst">&#123;NETDEVSDK.NETDEV_GetLastError()&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            lpRealHandle = IntPtr.Zero;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 云台控制</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzCommand&quot;&gt;</span>控制命令<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;isStart&quot;&gt;</span>是否启动<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;speed&quot;&gt;</span>速度<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">PtzControl</span>(<span class="params"><span class="built_in">int</span> channel, PTZCommand ptzCommand, <span class="built_in">bool</span> isStart, <span class="built_in">int</span> speed</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">int</span> dwPTZCommand = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (ptzCommand)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Light: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_LIGHTON : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_LIGHTOFF; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Wiper: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_BRUSHON : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_BRUSHOFF; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Fan: dwPTZCommand = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Heater: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_HEATON : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_HEATOFF; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.SnowRemoval: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_SNOWREMOINGON : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_SNOWREMOINGOFF; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Aux1: dwPTZCommand = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.Aux2: dwPTZCommand = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.SetPreset: dwPTZCommand = (<span class="built_in">int</span>)NETDEV_PTZ_PRESETCMD_E.NETDEV_PTZ_SET_PRESET; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.ClePreset: dwPTZCommand = (<span class="built_in">int</span>)NETDEV_PTZ_PRESETCMD_E.NETDEV_PTZ_CLE_PRESET; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.GotoPreset: dwPTZCommand = (<span class="built_in">int</span>)NETDEV_PTZ_PRESETCMD_E.NETDEV_PTZ_GOTO_PRESET; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> PTZCommand.ZoomIn: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ZOOMTELE : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ZOOMTELE_STOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.ZoomOut: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ZOOMWIDE : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ZOOMWIDE_STOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.FocusNear: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_FOCUSNEAR : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_FOCUSNEAR_STOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.FocusFar: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_FOCUSFAR : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_FOCUSFAR_STOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.IrisOpen: dwPTZCommand = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.IrisClose: dwPTZCommand = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">case</span> PTZCommand.TiltUp: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_TILTUP : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ALLSTOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.TiltDown: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_TILTDOWN : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ALLSTOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.PanLeft: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_PANLEFT : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ALLSTOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.PanRight: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_PANRIGHT : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ALLSTOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.UpLeft: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_LEFTUP : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ALLSTOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.UpRight: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_RIGHTUP : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ALLSTOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.DownLeft: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_LEFTDOWN : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ALLSTOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.DownRight: dwPTZCommand = isStart ? (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_RIGHTDOWN : (<span class="built_in">int</span>)NETDEV_PTZ_E.NETDEV_PTZ_ALLSTOP; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.PanAuto: dwPTZCommand = <span class="number">0</span>; <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (NETDEVSDK.FALSE == NETDEVSDK.NETDEV_PTZControl_Other(lpDevHandle, channel, dwPTZCommand, speed))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取云台 PTZ 值</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzValue&quot;&gt;</span>PTZ 参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">GetPTZValue</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> PTZValue ptzValue</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        NETDEV_PTZ_STATUS_S pstPTZStaus = <span class="keyword">new</span> NETDEV_PTZ_STATUS_S();</span><br><span class="line">        <span class="built_in">int</span> iRet = NETDEVSDK.NETDEV_PTZGetStatus(lpDevHandle, channel, <span class="keyword">ref</span> pstPTZStaus);</span><br><span class="line">        <span class="keyword">if</span> (NETDEVSDK.TRUE != iRet)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> iLastErr = <span class="string">$&quot;PTZ Get Status fail: <span class="subst">&#123;NETDEVSDK.NETDEV_GetLastError()&#125;</span>&quot;</span>;</span><br><span class="line">            ptzValue = <span class="keyword">new</span> PTZValue();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            ptzValue = <span class="keyword">new</span> PTZValue()</span><br><span class="line">            &#123;</span><br><span class="line">                P = (<span class="built_in">float</span>)Math.Round(<span class="built_in">decimal</span>.Parse(<span class="string">$&quot;<span class="subst">&#123;pstPTZStaus.fPanTiltX + <span class="number">1.0</span>&#125;</span>&quot;</span>) * <span class="number">180</span>m, <span class="number">2</span>),</span><br><span class="line">                T = (<span class="built_in">float</span>)Math.Round(<span class="built_in">decimal</span>.Parse(<span class="string">$&quot;<span class="subst">&#123;pstPTZStaus.fPanTiltY&#125;</span>&quot;</span>) * <span class="number">90</span>m, <span class="number">2</span>),</span><br><span class="line">                Z = (<span class="built_in">float</span>)Math.Round(pstPTZStaus.fZoomX * (max_zoom - <span class="number">1</span>) + <span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 设置云台 PTZ 值</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzValue&quot;&gt;</span>PTZ 参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否设置成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">SetPTZValue</span>(<span class="params"><span class="built_in">int</span> channel, PTZValue ptzValue</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        NETDEV_PTZ_ABSOLUTE_MOVE_S pstAbsoluteMove = <span class="keyword">new</span> NETDEV_PTZ_ABSOLUTE_MOVE_S();</span><br><span class="line">        pstAbsoluteMove.fPanTiltX = ptzValue.P / <span class="number">180f</span> - <span class="number">1.0f</span>;</span><br><span class="line">        pstAbsoluteMove.fPanTiltY = ptzValue.T / <span class="number">90f</span>;</span><br><span class="line">        pstAbsoluteMove.fZoomX = (ptzValue.Z - <span class="number">1</span>) / (max_zoom - <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">int</span> iRet = NETDEVSDK.NETDEV_PTZAbsoluteMove(lpDevHandle, channel, pstAbsoluteMove);</span><br><span class="line">        <span class="keyword">if</span> (NETDEVSDK.TRUE != iRet)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> iLastErr = <span class="string">$&quot;PTZ Absolute Move fail: <span class="subst">&#123;NETDEVSDK.NETDEV_GetLastError()&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取云台预置位列表</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzPresets&quot;&gt;</span>预置位列表<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">GetPTZPreset</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> List&lt;PTZPreset&gt; ptzPresets</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        ptzPresets = <span class="keyword">new</span> List&lt;PTZPreset&gt;();</span><br><span class="line"></span><br><span class="line">        NETDEV_PTZ_ALLPRESETS_S stPtzPresets = <span class="keyword">new</span> NETDEV_PTZ_ALLPRESETS_S();</span><br><span class="line">        <span class="built_in">int</span> iRet = NETDEVSDK.NETDEV_GetPTZPresetList(lpDevHandle, channel, <span class="keyword">ref</span> stPtzPresets);</span><br><span class="line">        <span class="keyword">if</span> (NETDEVSDK.TRUE != iRet)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> vError = NETDEVSDK.NETDEV_GetLastError();</span><br><span class="line">            <span class="keyword">if</span> (<span class="number">113</span> == vError)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// NETDEV_E_NOT_SUPPORT 113 设备不支持该功能</span></span><br><span class="line">                <span class="keyword">var</span> iLastErr = <span class="string">$&quot;Get PTZ Preset List fail: <span class="subst">&#123;vError&#125;</span>&quot;</span>;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; stPtzPresets.dwSize; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                ptzPresets.Add(<span class="keyword">new</span> PTZPreset()</span><br><span class="line">                &#123;</span><br><span class="line">                    ID = stPtzPresets.astPreset[i].dwPresetID,</span><br><span class="line">                    Name = UniviewEncoding.GetDefaultString(stPtzPresets.astPreset[i].szPresetName)</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据预置位编号排序</span></span><br><span class="line">        ptzPresets = ptzPresets.OrderBy(x =&gt; x.ID).ToList();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 云台预置位控制</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzCommand&quot;&gt;</span>控制命令<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;presetIndex&quot;&gt;</span>预置位序号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;presetName&quot;&gt;</span>预置位名称，设置预置位时使用<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">PTZPresetControl</span>(<span class="params"><span class="built_in">int</span> channel, PTZCommand ptzCommand, <span class="built_in">int</span> presetIndex, <span class="built_in">string</span> presetName</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="built_in">int</span> dwPTZCommand = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">switch</span> (ptzCommand)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.SetPreset: dwPTZCommand = (<span class="built_in">int</span>)NETDEV_PTZ_PRESETCMD_E.NETDEV_PTZ_SET_PRESET; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.ClePreset: dwPTZCommand = (<span class="built_in">int</span>)NETDEV_PTZ_PRESETCMD_E.NETDEV_PTZ_CLE_PRESET; <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.GotoPreset: dwPTZCommand = (<span class="built_in">int</span>)NETDEV_PTZ_PRESETCMD_E.NETDEV_PTZ_GOTO_PRESET; <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">byte</span>[] byPresetName;</span><br><span class="line">        UniviewEncoding.GetUTF8Buffer(presetName, NETDEVSDK.NETDEV_LEN_32, <span class="keyword">out</span> byPresetName);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">int</span> iRet = NETDEVSDK.NETDEV_PTZPreset_Other(lpDevHandle, channel, dwPTZCommand, byPresetName, presetIndex);</span><br><span class="line">        <span class="keyword">if</span> (NETDEVSDK.TRUE != iRet)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> iLastErr = <span class="string">$&quot;Go to preset fail: <span class="subst">&#123;NETDEVSDK.NETDEV_GetLastError()&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取缩放最大倍数</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 通过 LAPI Digest 鉴权获取</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ip&quot;&gt;</span>球机 IP<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;userName&quot;&gt;</span>用户名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;password&quot;&gt;</span>密码<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">async</span> Task&lt;<span class="built_in">int</span>&gt; <span class="title">GetMaxZoom</span>(<span class="params"><span class="built_in">string</span> ip, <span class="built_in">string</span> userName, <span class="built_in">string</span> password</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 发送 GET 请求到 API 的 URL</span></span><br><span class="line">            <span class="keyword">var</span> baseAddress = <span class="keyword">new</span> Uri(<span class="string">$&quot;http://<span class="subst">&#123;ip&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建一个具有 Digest 鉴权的 HttpClientHandler</span></span><br><span class="line">            <span class="keyword">var</span> handler = <span class="keyword">new</span> HttpClientHandler</span><br><span class="line">            &#123;</span><br><span class="line">                Credentials = <span class="keyword">new</span> NetworkCredential(userName, password),</span><br><span class="line">                PreAuthenticate = <span class="literal">true</span></span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> client = <span class="keyword">new</span> HttpClient(handler)</span><br><span class="line">            &#123;</span><br><span class="line">                BaseAddress = baseAddress</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> response = <span class="keyword">await</span> client.GetAsync(<span class="string">&quot;/LAPI/V1.0/Channel/0/System/DigitalZoom&quot;</span>);</span><br><span class="line">            <span class="comment">// 检查响应状态码</span></span><br><span class="line">            <span class="keyword">if</span> (response.IsSuccessStatusCode)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 处理成功响应</span></span><br><span class="line">                <span class="keyword">var</span> responseBody = <span class="keyword">await</span> response.Content.ReadAsStringAsync();</span><br><span class="line">                <span class="keyword">var</span> vDigitalZoom = JsonConvert.DeserializeObject&lt;DigitalZoomModel&gt;(responseBody);</span><br><span class="line">                <span class="keyword">return</span> (<span class="built_in">int</span>)vDigitalZoom?.Response?.Data?.MaxDigitalZoom;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 错误响应</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        catch (Exception)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 处理异常</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="大华"><a href="#大华" class="headerlink" title="大华"></a>大华</h4><p>使用 <a target="_blank" rel="noopener" href="https://support.dahuatech.com/tools/sdkExploit">官方 SDK</a> 对接（缺少调试设备，暂时未对接完）。</p>
<h4 id="Onvif"><a href="#Onvif" class="headerlink" title="Onvif"></a>Onvif</h4><p>参考 <a target="_blank" rel="noopener" href="https://www.onvif.org/profiles/specifications/">网络接口协议</a> 在项目中使用 WCF 引用 WSDL。<br>Onvif 与直接对接厂商 SDK 不同，它只提供了网络接口协议与设备通讯，所以预览视频只能通过协议获取到 RTSP 地址后播放。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Onvif 相机控制</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">OnvifControl</span> : <span class="title">ICameraControl</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Onvif 相机</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> OnvifCamera onvifCamera;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Profiles</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> CameraControl.Onvif.Client.Common.Profile[] profiles;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> Onvif 相机控制构造函数</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ip&quot;&gt;</span>IP<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;userName&quot;&gt;</span>用户名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;password&quot;&gt;</span>密码<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OnvifControl</span>(<span class="params"><span class="built_in">string</span> ip, <span class="built_in">string</span> userName, <span class="built_in">string</span> password</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        onvifCamera = <span class="keyword">new</span> OnvifCamera(ip, userName, password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 登录</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channels&quot;&gt;</span>通道号集合<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否登录成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Login</span>(<span class="params"><span class="keyword">out</span> List&lt;CameraChannel&gt; channels</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        channels = <span class="keyword">new</span> List&lt;CameraChannel&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> vProfilesTask = Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Media.GetProfilesAsync());</span><br><span class="line">            <span class="keyword">var</span> vProfiles = vProfilesTask.Result;</span><br><span class="line"></span><br><span class="line">            profiles = vProfiles.Profiles;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; profiles.Length; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                channels.Add(<span class="keyword">new</span> CameraChannel()</span><br><span class="line">                &#123;</span><br><span class="line">                    ChannelID = i,</span><br><span class="line">                    ChannelName = profiles[i].token</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        catch (Exception ex)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> err = <span class="string">$&quot;GetProfilesAsync Error:<span class="subst">&#123;ex&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 退出登录</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否退出成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">Logout</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// Onvif 没有退出，无论如何都返回失败</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取流 RTSP 地址</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;streamUris&quot;&gt;</span>流地址集合<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否获取成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">GetStreamUri</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> List&lt;<span class="built_in">string</span>&gt; streamUris</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        streamUris = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> token = profiles[channel].token;</span><br><span class="line">            <span class="keyword">var</span> vPresetsTask = Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Media.GetStreamUriAsync(<span class="keyword">new</span> CameraControl.Onvif.Client.Common.StreamSetup()</span><br><span class="line">            &#123;</span><br><span class="line">                Stream = CameraControl.Onvif.Client.Common.StreamType.RTPUnicast,</span><br><span class="line">                Transport = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.Transport()</span><br><span class="line">                &#123;</span><br><span class="line">                    Protocol = CameraControl.Onvif.Client.Common.TransportProtocol.UDP</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, token));</span><br><span class="line">            <span class="keyword">var</span> vPresets = vPresetsTask.Result;</span><br><span class="line">            streamUris.Add(vPresets.Uri.Insert(<span class="number">7</span>, <span class="string">$&quot;<span class="subst">&#123;onvifCamera.UserName&#125;</span>:<span class="subst">&#123;onvifCamera.Password&#125;</span>@&quot;</span>));</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        catch (Exception ex)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> err = <span class="string">$&quot;GetStreamUriAsync Error:<span class="subst">&#123;ex&#125;</span>&quot;</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 实时预览</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;hPlayWnd&quot;&gt;</span>渲染句柄<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">RealPlay</span>(<span class="params"><span class="built_in">int</span> channel, IntPtr hPlayWnd</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// Onvif 目前只能获取到 RTSP 地址，无法直接预览</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 停止实时预览</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">StopRealPlay</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// Onvif 目前只能获取到 RTSP 地址，无法直接预览</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 云台控制</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 方向、变焦、变倍、光圈</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 灯光、雨刷、风扇、加热、除雪</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzCommand&quot;&gt;</span>控制命令<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;isStart&quot;&gt;</span>是否启动<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;speed&quot;&gt;</span>速度<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">PtzControl</span>(<span class="params"><span class="built_in">int</span> channel, PTZCommand ptzCommand, <span class="built_in">bool</span> isStart, <span class="built_in">int</span> speed = <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">var</span> token = profiles[channel].token;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isStart)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">float</span> vP = <span class="number">0</span>, vT = <span class="number">0</span>, vZ = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Onvif Speed 参数范围 [0~100]，需要转换为 [0~1]</span></span><br><span class="line">            <span class="keyword">var</span> vSpeed = (<span class="built_in">float</span>)Math.Round((<span class="built_in">double</span>)speed / <span class="number">100</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">switch</span> (ptzCommand)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">case</span> PTZCommand.ZoomIn: vZ = vSpeed; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PTZCommand.ZoomOut: vZ = -vSpeed; <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">case</span> PTZCommand.TiltUp: vT = vSpeed; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PTZCommand.TiltDown: vT = -vSpeed; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PTZCommand.PanLeft: vP = -vSpeed; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PTZCommand.PanRight: vP = vSpeed; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PTZCommand.UpLeft: vP = -vSpeed; vT = vSpeed; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PTZCommand.UpRight: vP = vSpeed; vT = vSpeed; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PTZCommand.DownLeft: vP = -vSpeed; vT = -vSpeed; <span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">case</span> PTZCommand.DownRight: vP = vSpeed; vT = -vSpeed; <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            CameraControl.Onvif.Client.Common.PTZSpeed ptzSpeed = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.PTZSpeed()</span><br><span class="line">            &#123;</span><br><span class="line">                PanTilt = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.Vector2D()</span><br><span class="line">                &#123;</span><br><span class="line">                    x = vP,</span><br><span class="line">                    y = vT</span><br><span class="line">                &#125;,</span><br><span class="line">                Zoom = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.Vector1D()</span><br><span class="line">                &#123;</span><br><span class="line">                    x = vZ</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line"></span><br><span class="line">            Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Ptz.ContinuousMoveAsync(token, ptzSpeed));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Ptz.StopAsync(token, <span class="literal">true</span>, <span class="literal">true</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取云台 PTZ 值</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzValue&quot;&gt;</span>PTZ 参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">GetPTZValue</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> PTZValue ptzValue</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        ptzValue = <span class="keyword">new</span> PTZValue();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> token = profiles[channel].token;</span><br><span class="line">        <span class="keyword">var</span> vGetStatusTask = Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Ptz.GetStatusAsync(token));</span><br><span class="line">        <span class="keyword">var</span> vGetStatus = vGetStatusTask.Result;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (vGetStatus != <span class="literal">null</span> &amp;&amp; vGetStatus.Position != <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            ptzValue.P = vGetStatus.Position.PanTilt.x;</span><br><span class="line">            ptzValue.T = vGetStatus.Position.PanTilt.y;</span><br><span class="line">            ptzValue.Z = vGetStatus.Position.Zoom.x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 设置云台 PTZ 值</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzValue&quot;&gt;</span>PTZ 参数<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否设置成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">SetPTZValue</span>(<span class="params"><span class="built_in">int</span> channel, PTZValue ptzValue</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">// 获取球机绝对移动范围</span></span><br><span class="line">        <span class="keyword">var</span> vGetNodesTask = Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Ptz.GetNodesAsync());</span><br><span class="line">        <span class="keyword">var</span> vGetNodes = vGetNodesTask.Result;</span><br><span class="line">        <span class="keyword">if</span> (vGetNodes != <span class="literal">null</span> &amp;&amp; vGetNodes.PTZNode != <span class="literal">null</span> &amp;&amp; vGetNodes.PTZNode.Count() &gt;= <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">var</span> vPanTilt = vGetNodes.PTZNode[<span class="number">0</span>].SupportedPTZSpaces.AbsolutePanTiltPositionSpace;</span><br><span class="line">            <span class="keyword">var</span> vZoom = vGetNodes.PTZNode[<span class="number">0</span>].SupportedPTZSpaces.AbsoluteZoomPositionSpace;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用球机绝对移动</span></span><br><span class="line">        <span class="keyword">var</span> token = profiles[channel].token;</span><br><span class="line">        <span class="keyword">var</span> vectorPT = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.PTZVector &#123; PanTilt = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.Vector2D &#123; x = ptzValue.P, y = ptzValue.T &#125; &#125;;</span><br><span class="line">        <span class="keyword">var</span> speedPT = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.PTZSpeed &#123; PanTilt = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.Vector2D &#123; x = <span class="number">1f</span>, y = <span class="number">1f</span> &#125; &#125;;</span><br><span class="line">        Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Ptz.AbsoluteMoveAsync(token, vectorPT, speedPT));</span><br><span class="line">        Thread.Sleep(<span class="number">1000</span>);</span><br><span class="line">        <span class="keyword">var</span> vectorZ = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.PTZVector &#123; Zoom = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.Vector1D &#123; x = ptzValue.Z &#125; &#125;;</span><br><span class="line">        <span class="keyword">var</span> speedZ = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.PTZSpeed &#123; Zoom = <span class="keyword">new</span> CameraControl.Onvif.Client.Common.Vector1D &#123; x = <span class="number">1f</span> &#125; &#125;;</span><br><span class="line">        Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Ptz.AbsoluteMoveAsync(token, vectorZ, speedZ));</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 获取云台预置位列表</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzPresets&quot;&gt;</span>预置位列表<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">GetPTZPreset</span>(<span class="params"><span class="built_in">int</span> channel, <span class="keyword">out</span> List&lt;PTZPreset&gt; ptzPresets</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        ptzPresets = <span class="keyword">new</span> List&lt;PTZPreset&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> token = profiles[channel].token;</span><br><span class="line">        <span class="keyword">var</span> vPresetsTask = Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Ptz.GetPresetsAsync(token));</span><br><span class="line">        <span class="keyword">var</span> vPresets = vPresetsTask.Result;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">var</span> item <span class="keyword">in</span> vPresets.Preset)</span><br><span class="line">        &#123;</span><br><span class="line">            ptzPresets.Add(<span class="keyword">new</span> PTZPreset()</span><br><span class="line">            &#123;</span><br><span class="line">                ID = <span class="built_in">int</span>.Parse(item.token),</span><br><span class="line">                Name = item.Name</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 根据预置位编号排序</span></span><br><span class="line">        ptzPresets = ptzPresets.OrderBy(x =&gt; x.ID).ToList();</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 云台预置位控制</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;channel&quot;&gt;</span>通道号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;ptzCommand&quot;&gt;</span>控制命令<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;presetIndex&quot;&gt;</span>预置位序号<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;presetName&quot;&gt;</span>预置位名称，设置预置位时使用<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>是否调用成功<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">PTZPresetControl</span>(<span class="params"><span class="built_in">int</span> channel, PTZCommand ptzCommand, <span class="built_in">int</span> presetIndex, <span class="built_in">string</span> presetName</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">var</span> token = profiles[channel].token;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (ptzCommand)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.SetPreset:</span><br><span class="line">                CameraControl.Onvif.Client.Ptz.SetPresetRequest setPresetRequest = <span class="keyword">new</span> CameraControl.Onvif.Client.Ptz.SetPresetRequest()</span><br><span class="line">                &#123;</span><br><span class="line">                    ProfileToken = token,</span><br><span class="line">                    PresetToken = <span class="string">$&quot;<span class="subst">&#123;presetIndex&#125;</span>&quot;</span>,</span><br><span class="line">                    PresetName = presetName</span><br><span class="line">                &#125;;</span><br><span class="line">                Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Ptz.SetPresetAsync(setPresetRequest));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.ClePreset:</span><br><span class="line">                Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Ptz.RemovePresetAsync(token, <span class="string">$&quot;<span class="subst">&#123;presetIndex&#125;</span>&quot;</span>));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> PTZCommand.GotoPreset:</span><br><span class="line">                Task.Run(<span class="keyword">async</span> () =&gt; <span class="keyword">await</span> onvifCamera.Ptz.GotoPresetAsync(token, <span class="string">$&quot;<span class="subst">&#123;presetIndex&#125;</span>&quot;</span>, <span class="keyword">new</span> CameraControl.Onvif.Client.Common.PTZSpeed()));</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
    </div>
      <footer class="post-footer">
          <div class="post-tags">
              <a href="/blog/tags/c/" rel="tag"># c#</a>
          </div>
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/blog/2023/11/10/photo-XiAn/" rel="prev" title="陕西 - 西安">
      <i class="fa fa-chevron-left"></i> 陕西 - 西安
    </a></div>
      <div class="post-nav-item">
    <a href="/blog/2024/01/14/csharp-NuGet/" rel="next" title="NuGet 包管理">
      NuGet 包管理 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
  </article>
          </div>
<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>
        </div>
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>
  <aside class="sidebar">
    <div class="sidebar-inner">
      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>
      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E4%BB%8B"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%B8%E5%BF%83%E4%BB%A3%E7%A0%81"><span class="nav-number">2.</span> <span class="nav-text">核心代码</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.1.</span> <span class="nav-text">接口</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%B7%E5%BA%B7"><span class="nav-number">2.2.</span> <span class="nav-text">海康</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%87%E8%A7%86"><span class="nav-number">2.3.</span> <span class="nav-text">宇视</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7%E5%8D%8E"><span class="nav-number">2.4.</span> <span class="nav-text">大华</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Onvif"><span class="nav-number">2.5.</span> <span class="nav-text">Onvif</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->
      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="LiuJiaHua"
      src="https://avatars3.githubusercontent.com/u/19670054?s=460&v=4">
  <p class="site-author-name" itemprop="name">LiuJiaHua</p>
  <div class="site-description" itemprop="description">记录生活,记录学习,记录成长!</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/blog/archives">
          <span class="site-state-item-count">143</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/blog/categories">
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/blog/tags">
        <span class="site-state-item-count">128</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>
      </div>
    </main>
    <footer class="footer">
      <div class="footer-inner">
<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">LiuJiaHua</span>
</div>
      </div>
    </footer>
  </div>
  <script src="/blog/lib/anime.min.js"></script>
  <script src="/blog/lib/velocity/velocity.min.js"></script>
  <script src="/blog/lib/velocity/velocity.ui.min.js"></script>
<script src="/blog/js/utils.js"></script>
<script src="/blog/js/motion.js"></script>
<script src="/blog/js/schemes/pisces.js"></script>
<script src="/blog/js/next-boot.js"></script>
<script src="/blog/js/local-search.js"></script>
</body>
</html>
